(function(a){a.fn.html5uploader=function(b){var c=a(this);b=a.extend({},a.fn.html5uploader.defaultArgs,b);b.name=c.attr("id");if(!b.action){throw"PHP File Handler is missing";return false}c.click(function(){var n=a('<div id="'+b.name+'"></div>');var k=a("<div/>").css({position:"fixed",width:"100%",height:"100%",background:"#000",opacity:0.5,top:"0px",left:"0px"}).appendTo(n);var g=a("<div/>").css({width:"260px",height:"100px",background:"#fff",position:"fixed",top:"50%",left:"50%","margin-top":"-50px","margin-left":"-130px",padding:"20px","border-radius":"4px",opacity:0.8}).appendTo(n);var j=a('<input type="file" accept="'+b.accept+'"/>').css({width:"auto",margin:"0px"}).appendTo(g);var e=a("<div/>").css({font:"12px/12px arial",margin:"5px","text-align":"center",width:"260px",overflow:"hidden"}).appendTo(g);var d=a("<div/>").css({position:"relative",width:"260px",height:"20px",border:"1px solid #ccc","text-align":"center",display:"none"}).appendTo(g);var l=a("<div/>").css({position:"absolute",top:"0px",left:"0px",width:"0px",height:"20px",background:"#09f"}).appendTo(d);var m=a("<span/>").css({position:"relative",font:"12px/12px arial"}).appendTo(d);var h=a("<div/>").css({position:"absolute",right:"20px",top:"100px",font:"12px/12px arial","text-align":"right",display:"none"}).appendTo(g);var p=a("<div>Elapsed </div>").css({"margin-top":"3px"}).appendTo(h);var q=a("<span/>").appendTo(p);var o=a("<div>Remaining </div>").appendTo(h);var i=a("<span/>").appendTo(o);var f=a("<div>X</div>").css({width:"15px",height:"15px",color:"#fff",font:"bold 15px/15px arial",cursor:"pointer",margin:"0px",padding:"0px",position:"fixed",left:"50%","margin-left":"160px",top:"50%","margin-top":"-70px"}).appendTo(n);a("body").append(n);f.unbind("click");f.click(function(){n.remove();return false});a(document).unbind("keyup");a(document).keyup(function(r){if(r.keyCode==27){n.remove()}return false});j.css("display","block");f.css("display","block");j.unbind("change");j.change(function(){f.css("display","none");a(document).unbind("keyup");j.css("display","none");var t=a(this).prop("files")[0];var r=new FileReader();e.html("File: "+t.name+" ("+Math.floor((t.size)*0.001)+" KB)");var s=0;var x=b.chunk;var v=Math.floor(t.size/x);if(t.size%x!=0){v++}var u=Date.now();function w(){var A=s*x;var y=s==v-1?A+(t.size%x):A+x;var z=t.slice(A,y);r.readAsDataURL(z)}r.onloadend=function(A){var B=s==0?1:0;var y=s==v-1?1:0;if(B){d.css("display","block");l.width(0);m.html("0%");h.css("display","block")}if(A.target.readyState==FileReader.DONE){var z=A.target.result;a.ajax({url:b.action,cache:false,type:"post",async:false,data:{name:t.name,index:s,first:B,last:y,data:z},success:function(G){var C=Math.floor(((s+1)/v)*100);l.width(C+"%");m.html(C+"%");var E=Date.now();var F={};F.time=E-u;F.sec=Math.floor((F.time/1000)%60);if(F.sec<10){F.sec="0"+F.sec}F.min=Math.floor((F.time/1000)/60);var D=((v)*F.time)/(s+1);var H={};H.time=Math.floor((D-F.time)/1000);H.sec=H.time%60;if(H.sec<10){H.sec="0"+H.sec}H.min=Math.floor(H.time/60);i.html(H.min+":"+H.sec);q.html(F.min+":"+F.sec);if(!y){s++;w()}else{b.success(G);n.remove()}}})}};w();return false});return false})};a.fn.html5uploader.defaultArgs={accept:"audio/*,video/*,image/*",success:function(){},action:null,chunk:50000}})(jQuery);