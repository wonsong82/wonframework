(function(a){a.fn.imageEditor=function(c){var b=a(this);a.loadImages([b.attr("src")],function(){c=a.extend({},a.fn.imageEditor.defaultArgs,c);c.editorWidth=b.width();c.editorHeight=b.height();var e;var k={};k.original={rw:parseInt(c.values[0]),rh:parseInt(c.values[1]),x:parseInt(c.values[2]),y:parseInt(c.values[3]),w:parseInt(c.values[4]),h:parseInt(c.values[5])};k.current={rw:parseInt(c.values[0]),rh:parseInt(c.values[1]),x:parseInt(c.values[2]),y:parseInt(c.values[3]),w:parseInt(c.values[4]),h:parseInt(c.values[5])};c.ratio=c.width/c.height;c.selectionScale=c.editorWidth/k.original.rw;var j=false;var g=a('<div class="imageEditor"></div>').appendTo(b.parent());var d=a("<div/>").css({position:"relative"}).appendTo(g);b.css({display:"block",position:"relative"}).appendTo(d);var l=a("<div/>").css({position:"relative"}).appendTo(g);a("<br/><span>Original Size:</span>").appendTo(l);a("<span>"+c.width+"</span>").css({width:"40px",display:"inline-block","font-weight":"bold","text-align":"center",margin:"0px 3px"}).appendTo(l);a("<span>x</span>").appendTo(l);a("<span>"+c.height+"</span>").css({width:"40px",display:"inline-block","font-weight":"bold","text-align":"center",margin:"0px 3px"}).appendTo(l);a("<span>px</span>").appendTo(l);a("<br/><br/><span>Resize to:</span>").appendTo(l);l.rw=a('<input type="text" class="rw control" key="rw" />').css({width:"30px","font-weight":"bold","text-align":"center",margin:"0px 3px"}).val(k.current.rw).appendTo(l);a("<span>x</span>").appendTo(l);l.rh=a('<input type="text" class="rh control" key="rh" />').css({width:"30px","font-weight":"bold","text-align":"center",margin:"0px 3px"}).val(k.current.rh).appendTo(l);a("<span>px</span>").appendTo(l);a("<br/><br/><span>Selection Position: x</span>").appendTo(l);l.x=a('<input type="text" class="x control" key="x" />').css({width:"30px","font-weight":"bold","text-align":"center",margin:"0px 3px"}).val(k.current.x).appendTo(l);a("<span>, y</span>").appendTo(l);l.y=a('<input type="text" class="y control" key="y" />').css({width:"30px","font-weight":"bold","text-align":"center",margin:"0px 3px"}).val(k.current.y).appendTo(l);a("<span> | </span>").appendTo(l);a("<span>Selection Size:</span>").appendTo(l);l.w=a('<input type="text" class="w control" key="w" />').css({width:"30px","font-weight":"bold","text-align":"center",margin:"0px 3px"}).val(k.current.w).appendTo(l);a("<span>x</span>").appendTo(l);l.h=a('<input type="text" class="h control" key="h" />').css({width:"30px","font-weight":"bold","text-align":"center",margin:"0px 3px"}).val(k.current.h).appendTo(l);a("<span>px</span><br/><br/>").appendTo(l);l.update=a("<button>UPDATE</button>").appendTo(l);l.cancel=a("<button>RESET</button>").appendTo(l);function i(n){var m=k.current.rw/c.editorWidth;k.current.x=Math.floor(n.x*m);k.current.y=Math.floor(n.y*m);k.current.w=Math.floor(n.w*m);k.current.h=Math.floor(n.h*m);l.x.val(k.current.x);l.y.val(k.current.y);l.w.val(k.current.w);l.h.val(k.current.h)}function h(n){if(j==true){var m=k.current.rw/c.editorWidth;k.current.x=Math.ceil(n.x*m);k.current.y=Math.ceil(n.y*m);k.current.w=Math.ceil(n.w*m);k.current.h=Math.ceil(n.h*m);l.x.val(k.current.x);l.y.val(k.current.y);l.w.val(k.current.w);l.h.val(k.current.h)}}function f(){var o=c.editorWidth/k.current.rw;var n=[Math.floor(k.current.x*o),Math.floor(k.current.y*o),Math.floor((k.current.x+k.current.w)*o),Math.floor((k.current.y+k.current.h)*o)];for(var m=0;m<n.length;m++){if(isNaN(n[m])){n[m]=0}}e.setSelect(n)}a(".control",g).keypress(function(m){if(m.keyCode>31&&(m.keyCode<48||m.keyCode>57)){return false}});a(".control",g).blur(function(){if(isNaN(parseInt(a(this).val()))){a(this).val(0);var m=a(this).attr("key");k.current[m]=0;f()}});l.rw.blur(function(){var m=l.rw.val()/k.current.rw;k.current.rw=parseInt(l.rw.val());if(isNaN(k.current.rw)){return false}k.current.rh=Math.floor(k.current.rw/c.ratio);k.current.x=Math.floor(k.current.x*m);k.current.y=Math.floor(k.current.y*m);k.current.w=Math.floor(k.current.w*m);k.current.h=Math.floor(k.current.h*m);l.rh.val(k.current.rh);l.x.val(k.current.x);l.y.val(k.current.y);l.w.val(k.current.w);l.h.val(k.current.h);f()});l.rh.blur(function(){var m=l.rh.val()/k.current.rh;k.current.rh=parseInt(l.rh.val());if(isNaN(k.current.rh)){return false}k.current.rw=Math.ceil(k.current.rh*c.ratio);k.current.x=Math.ceil(k.current.x*m);k.current.y=Math.ceil(k.current.y*m);k.current.w=Math.ceil(k.current.w*m);k.current.h=Math.ceil(k.current.h*m);l.rw.val(k.current.rw);l.x.val(k.current.x);l.y.val(k.current.y);l.w.val(k.current.w);l.h.val(k.current.h);f()});l.x.keyup(function(){k.current.x=parseInt(l.x.val());if(isNaN(k.current.x)){return false}if(k.current.x>k.current.rw){k.current.x=k.current.rw;l.x.val(k.current.x)}if(k.current.x+k.current.w>k.current.rw){k.current.w=k.current.rw-k.current.x;l.w.val(k.current.w)}f()});l.y.keyup(function(){k.current.y=parseInt(l.y.val());if(isNaN(k.current.y)){return false}if(k.current.y>k.current.rh){k.current.y=k.current.rh;l.y.val(k.current.y)}if(k.current.y+k.current.h>k.current.rh){k.current.h=k.current.rh-k.current.y;l.h.val(k.current.h)}f()});l.w.keyup(function(){k.current.w=parseInt(l.w.val());if(isNaN(k.current.w)){return false}if(k.current.w>k.current.rw-k.current.x){k.current.w=k.current.rw-k.current.x;l.w.val(k.current.w)}f()});l.h.keyup(function(){k.current.h=parseInt(l.h.val());if(isNaN(k.current.h)){return false}if(k.current.h>k.current.rh-k.current.y){k.current.h=k.current.rh-k.current.y;l.h.val(k.current.h)}f()});l.update.click(function(){c.update(k.current)});l.cancel.click(function(){for(var m in k.original){k.current[m]=k.original[m];l[m].val(k.current[m])}f()});b.Jcrop({setSelect:[Math.floor(k.current.x*c.selectionScale),Math.floor(k.current.y*c.selectionScale),Math.floor((k.current.x+k.current.w)*c.selectionScale),Math.floor((k.current.y+k.current.h)*c.selectionScale)],onSelect:i,onChange:h},function(){e=this;a(".jcrop-holder *",g).mousedown(function(){j=true});a(".jcrop-holder *",g).mouseup(function(){j=false})})})};a.fn.imageEditor.defaultArgs={width:0,height:0,values:[0,0,0,0,0,0],update:function(){}}})(jQuery);